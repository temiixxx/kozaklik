name: Build and Release APK

on:
  push:
    tags:
      - 'v*.*.*'  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –≤–∏–¥–∞ v1.0.0
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
      
    - name: Build Debug APK
      run: ./gradlew assembleDebug
      
    - name: Get version from tag
      id: tag_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      
    - name: Rename APK
      run: |
        mv app/build/outputs/apk/debug/app-debug.apk app/build/outputs/apk/debug/clicker-kozy-${{ steps.tag_version.outputs.VERSION }}.apk
      
    - name: Upload APK as artifact
      uses: actions/upload-artifact@v4
      with:
        name: clicker-kozy-apk
        path: app/build/outputs/apk/debug/clicker-kozy-*.apk
        retention-days: 30
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: app/build/outputs/apk/debug/clicker-kozy-*.apk
        body: |
          ## üéâ –ù–æ–≤—ã–π —Ä–µ–ª–∏–∑ –ö–ª–∏–∫–µ—Ä –∫–æ–∑—ã!
          
          ### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
          1. –°–∫–∞—á–∞–π—Ç–µ APK —Ñ–∞–π–ª –Ω–∏–∂–µ
          2. –ù–∞ Android: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –†–∞–∑—Ä–µ—à–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
          3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APK
          
          ### üì± –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
          - Android 10+ (API 29+)
          
          ### üêõ –°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ:
          –°–æ–∑–¥–∞–π—Ç–µ [Issue](https://github.com/temiixxx/kozaklik/issues) –µ—Å–ª–∏ –Ω–∞—à–ª–∏ –±–∞–≥!
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
